<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coherence Kernel | ICU Vault</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .maintain-green { background-color: #10b981; box-shadow: 0 0 20px #10b981; }
        .alert-yellow { background-color: #f59e0b; box-shadow: 0 0 20px #f59e0b; }
        .trigger-red { background-color: #ef4444; box-shadow: 0 0 20px #ef4444; }
        .m-input { width: 100%; background: #000; color: #fff; padding: 4px; border-radius: 4px; border: 1px solid #334155; font-size: 11px; text-center; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 p-4 font-sans">

    <div class="max-w-md mx-auto space-y-4">
        <div class="bg-slate-800 p-6 rounded-3xl border border-slate-700 text-center">
            <div id="status-light" class="w-24 h-24 mx-auto rounded-full border-4 border-slate-900 flex flex-col justify-center items-center bg-slate-950 transition-all duration-700">
                <span id="verdict-label" class="text-[10px] font-bold">IDLE</span>
                <span id="omega-value" class="text-sm font-mono font-black">0.000</span>
            </div>
            <h2 class="mt-4 text-xs font-black text-indigo-400 tracking-widest uppercase">Clinical Decision Guardrail</h2>
        </div>

        <div class="bg-slate-800/50 p-4 rounded-2xl border border-slate-700">
            <div class="grid grid-cols-5 gap-2 mb-4">
                <div><p class="text-[7px] text-slate-500 uppercase">Sys</p><input type="number" id="v0" value="120" class="m-input"></div>
                <div><p class="text-[7px] text-slate-500 uppercase">Dia</p><input type="number" id="v1" value="80" class="m-input"></div>
                <div><p class="text-[7px] text-slate-500 uppercase">Pulse</p><input type="number" id="v2" value="72" class="m-input"></div>
                <div><p class="text-[7px] text-slate-500 uppercase">SpO2</p><input type="number" id="v3" value="98" class="m-input"></div>
                <div><p class="text-[7px] text-slate-500 uppercase">Resp</p><input type="number" id="v4" value="16" class="m-input"></div>
            </div>
            <button onclick="runTrial()" class="w-full py-3 bg-indigo-600 rounded-xl font-bold text-xs uppercase tracking-tighter shadow-lg active:scale-95">Process Hybrinear Trial</button>
        </div>

        <div class="bg-slate-800/50 p-4 rounded-2xl border border-slate-700 h-40">
            <canvas id="stabilityChart"></canvas>
        </div>

        <div class="bg-black/40 rounded-xl border border-slate-800 overflow-hidden">
            <table class="w-full text-[10px] text-left">
                <thead class="bg-slate-900 text-slate-500 uppercase">
                    <tr><th class="p-2">Trial</th><th class="p-2">Omega</th><th class="p-2">Verdict</th></tr>
                </thead>
                <tbody id="logBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        let trials = [];
        let scores = [];
        const ctx = document.getElementById('stabilityChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: { labels: trials, datasets: [{ label: 'Stability Index', data: scores, borderColor: '#6366f1', tension: 0.4 }] },
            options: { scales: { y: { min: 0, max: 1 } }, plugins: { legend: { display: false } } }
        });

        async function runTrial() {
            const vitals = Array.from({length: 10}, (_, i) => parseFloat(document.getElementById(`v${i}`)?.value || 0));
            
            // SECURITY: Call the Vault for the proprietary math
            const resp = await fetch('https://coherence-vault.vercel.app/api', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ vitals: vitals })
            });
            const data = await resp.json();

            // UI Update
            const light = document.getElementById('status-light');
            const style = data.verdict === "CRITICAL" ? "trigger-red" : (data.verdict === "ALERT" ? "alert-yellow" : "maintain-green");
            light.className = `w-24 h-24 mx-auto rounded-full border-4 border-slate-900 flex flex-col justify-center items-center transition-all duration-700 ${style}`;
            document.getElementById('verdict-label').innerText = data.verdict;
            document.getElementById('omega-value').innerText = data.score;

            // Chart & Log Update
            trials.push("#" + (trials.length + 1));
            scores.push(data.score);
            chart.update();

            const row = `<tr class="border-b border-slate-800"><td class="p-2">#${trials.length}</td><td class="p-2 font-mono">${data.score}</td><td class="p-2 font-bold">${data.verdict}</td></tr>`;
            document.getElementById('logBody').innerHTML = row + document.getElementById('logBody').innerHTML;
        }
    </script>
</body>
</html>
