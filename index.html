<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hybrinear Vault</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        .trigger-red { background: #ef4444; box-shadow: 0 0 25px #ef4444; }
        .drift-orange { background: #f59e0b; box-shadow: 0 0 25px #f59e0b; }
        .normal-green { background: #10b981; box-shadow: 0 0 25px #10b981; }
        .m-input { width: 100%; background: #000; color: #fff; padding: 10px; border: 1px solid #334; font-size: 13px; border-radius: 6px; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 p-4">
    <div class="max-w-md mx-auto space-y-4">
        <div id="status-light" class="w-32 h-32 mx-auto rounded-full border-4 border-slate-950 flex flex-col justify-center items-center bg-slate-800">
            <span id="v-lab" class="text-[10px] font-bold">IDLE</span>
            <span id="o-val" class="text-lg font-mono">0.0000</span>
        </div>

        <div class="grid grid-cols-2 gap-3 bg-slate-800 p-5 rounded-2xl">
            <input type="number" id="v0" placeholder="SYS (120)" class="m-input">
            <input type="number" id="v1" placeholder="DIA (80)" class="m-input">
            <input type="number" id="v2" placeholder="HR (72)" class="m-input">
            <input type="number" id="v3" placeholder="SpO2 (98)" class="m-input">
            <input type="number" id="v4" placeholder="RR (16)" class="m-input">
            <input type="number" id="v5" placeholder="TEMP (36.6)" class="m-input">
            <input type="number" id="v6" placeholder="GLU (90)" class="m-input">
            <input type="number" id="v7" placeholder="URINE (50)" class="m-input">
            <input type="number" id="v8" placeholder="LAC (1.2)" class="m-input">
            <input type="number" id="v9" placeholder="WBC (7.5)" class="m-input">
            <button onclick="process()" class="col-span-2 py-4 bg-indigo-600 rounded-xl font-bold uppercase">Process Trial</button>
        </div>

        <div class="bg-black/40 rounded-2xl p-4 border border-slate-800">
            <div class="flex justify-between mb-4 text-[10px] font-bold uppercase">
                <button onclick="exportFull('pdf')" class="text-indigo-400">PDF Report</button>
                <button onclick="exportFull('wa')" class="text-emerald-400">WhatsApp</button>
                <button onclick="location.reload()" class="text-rose-500">Clear</button>
            </div>
            <table class="w-full text-left text-[11px] font-mono"><tbody id="log"></tbody></table>
        </div>
    </div>

    <script>
        let sessionData = [];
        const labels = ["SYS", "DIA", "HR", "SpO2", "RR", "TEMP", "GLU", "URINE", "LAC", "WBC"];
        const defaults = [120, 80, 72, 98, 16, 36.6, 90, 50, 1.2, 7.5];

        async function process() {
            const vitals = Array.from({length:10}, (_,i) => {
                const val = document.getElementById(`v${i}`).value;
                return val === "" ? defaults[i] : parseFloat(val);
            });

            try {
                // FIXED: Replace 'YOUR-APP' with your actual Vercel URL
                const resp = await fetch('https://YOUR-APP.vercel.app/api', { 
                    method:'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({vitals}) 
                });
                const data = await resp.json();
                sessionData.push({...data, raw: vitals});
                
                const light = document.getElementById('status-light');
                if (data.score < 0.368) light.className = "w-32 h-32 mx-auto rounded-full border-4 border-slate-950 flex flex-col justify-center items-center trigger-red";
                else if (data.score <= 0.85) light.className = "w-32 h-32 mx-auto rounded-full border-4 border-slate-950 flex flex-col justify-center items-center drift-orange";
                else light.className = "w-32 h-32 mx-auto rounded-full border-4 border-slate-950 flex flex-col justify-center items-center normal-green";

                document.getElementById('v-lab').innerText = data.verdict;
                document.getElementById('o-val').innerText = data.score.toFixed(4);
                document.getElementById('log').insertAdjacentHTML('afterbegin', `<tr class="border-b border-slate-800"><td class="py-2">${data.timestamp}</td><td>${data.score}</td><td class="text-right">${data.verdict}</td></tr>`);
            } catch (e) { alert("Vault Connection Failure. Check URL in code."); }
        }

        function exportFull(type) {
            const last = sessionData[sessionData.length-1];
            if (!last) return;
            let detail = sessionData.map(d => `${d.timestamp}|S:${d.score}|${d.raw.join(',')}`).join('\n');
            
            if (type === 'pdf') {
                const { jsPDF } = window.jspdf; const doc = new jsPDF();
                doc.setFontSize(8); doc.text(detail, 10, 10); doc.save("Full_Report.pdf");
            } else {
                let msg = `*Latest Audit*%0A*Score:* ${last.score}%0A*Vitals:* ${last.raw.join(', ')}`;
                window.open(`https://api.whatsapp.com/send?text=${msg}`);
            }
        }
    </script>
</body>
</html>
